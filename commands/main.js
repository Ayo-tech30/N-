const moment = require('moment-timezone');

const menu = async ({ sock, msg, from, sender, db }) => {
    const userRef = db.collection('users').doc(sender);
    const userDoc = await userRef.get();
    const userData = userDoc.data();

    const menuText = `â•­â”â”ğ–£” ğ—¡ğ—˜ğ—«ğ—¢ğ—¥ğ—” ğ–£”â”â”â•®
â”‚  âœ¦ ğ™‹ğ™§ğ™šğ™›ğ™ğ™­   :  .
â”‚  âœ¦ ğ˜½ğ™¤ğ™© ğ™‰ğ™–ğ™¢ğ™š :  ğ—©ğ—¶ğ—¼ğ—¹ğ—²ğ˜
â”‚  âœ¦ ğ™Šğ™¬ğ™£ğ™šğ™§    :  ğ—ğ˜†ğ—»ğ˜…
â”‚  âœ¦ ğ™ğ™©ğ™–ğ™©ğ™ªğ™¨   :  ğ™Šğ™£ğ™¡ğ™ğ™£ğ™š âœ“
â”‚  âœ¦ ğ˜¿ğ˜½        :  Firebase ğŸ”¥
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯

âš™ï¸ ğ™ˆğ˜¼ğ™„ğ™‰ ğ™ˆğ™€ğ™‰ğ™ âš™ï¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™¢ğ™šğ™£ğ™ª
á¯½ .ğ™¥ğ™ğ™£ğ™œ
á¯½ .ğ™–ğ™¡ğ™ğ™«ğ™š
á¯½ .ğ™–ğ™›ğ™ 
á¯½ .ğ™§ğ™šğ™œğ™ğ™¨ğ™©ğ™šğ™§ | .ğ™§ğ™šğ™œ
á¯½ .ğ™¡ğ™šğ™–ğ™™ğ™šğ™§ğ™—ğ™¤ğ™–ğ™§ğ™™ | .ğ™¡ğ™—
á¯½ .ğ™¢ğ™–ğ™§ğ™ ğ™šğ™©
á¯½ .ğ™¢ğ™ªğ™œğ™šğ™£

ğŸ‘¤ ğ™‹ğ™ğ™Šğ™ğ™„ğ™‡ğ™€ ğ™ˆğ™€ğ™‰ğ™ ğŸ‘¤
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™¥ | .ğ™¥ğ™§ğ™¤ğ™›ğ™ğ™¡ğ™š [@ğ™ªğ™¨ğ™šğ™§]
á¯½ .ğ™¨ğ™šğ™©ğ™¥ğ™§ğ™¤ğ™›ğ™ğ™¡ğ™š | .ğ™¨ğ™šğ™©ğ™¥
á¯½ .ğ™¨ğ™šğ™©ğ™¥ğ™§ğ™¤ğ™›ğ™ğ™¡ğ™šğ™¦ğ™ªğ™¤ğ™©ğ™š
á¯½ .ğ™¨ğ™šğ™©ğ™–ğ™œğ™š <ğ™£ğ™ªğ™¢>
á¯½ .ğ™¨ğ™šğ™©ğ™£ğ™–ğ™¢ğ™š <ğ™£ğ™–ğ™¢ğ™š>

ğŸ›¡ï¸ ğ™‚ğ™ğ™Šğ™ğ™‹ ğ˜¼ğ˜¿ğ™ˆğ™„ğ™‰ ğŸ›¡ï¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™¥ğ™§ğ™¤ğ™¢ğ™¤ğ™©ğ™š @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™™ğ™šğ™¢ğ™¤ğ™©ğ™š @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™¢ğ™ªğ™©ğ™š @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™ªğ™£ğ™¢ğ™ªğ™©ğ™š @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™¬ğ™–ğ™§ğ™£ @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™¬ğ™–ğ™§ğ™£ğ™˜ğ™¤ğ™ªğ™£ğ™© @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™§ğ™šğ™¨ğ™šğ™©ğ™¬ğ™–ğ™§ğ™£ @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™ ğ™ğ™˜ğ™  @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™™ğ™šğ™¡ğ™šğ™©ğ™š
á¯½ .ğ™©ğ™–ğ™œğ™–ğ™¡ğ™¡
á¯½ .ğ™ğ™ğ™™ğ™šğ™©ğ™–ğ™œ
á¯½ .ğ™¬ğ™šğ™¡ğ™˜ğ™¤ğ™¢ğ™š <ğ™¤ğ™£/ğ™¤ğ™›ğ™›>
á¯½ .ğ™œğ™¤ğ™¤ğ™™ğ™—ğ™®ğ™š <ğ™¤ğ™£/ğ™¤ğ™›ğ™›>
á¯½ .ğ™–ğ™£ğ™©ğ™ğ™¡ğ™ğ™£ğ™  <ğ™¤ğ™£/ğ™¤ğ™›ğ™›>
á¯½ .ğ™œğ™§ğ™¤ğ™ªğ™¥ğ™ğ™£ğ™›ğ™¤

ğŸ´ ğ˜¾ğ˜¼ğ™ğ˜¿ğ™ ğ™ˆğ™€ğ™‰ğ™ ğŸ´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™¢ğ™®ğ™˜ğ™–ğ™§ğ™™ğ™¨
á¯½ .ğ™œğ™šğ™© <ğ™ğ™™>
á¯½ .ğ™™ğ™šğ™˜ğ™ 
á¯½ .ğ™œğ™ğ™«ğ™šğ™˜ğ™–ğ™§ğ™™ @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™¨ğ™šğ™¡ğ™¡ğ™˜ğ™–ğ™§ğ™™
á¯½ .ğ™–ğ™ªğ™˜ğ™©ğ™ğ™¤ğ™£
á¯½ .ğ™—ğ™ğ™™
á¯½ .ğ™§ğ™¤ğ™¡ğ™¡ğ™˜ğ™–ğ™§ğ™™
á¯½ .ğ™˜ğ™–ğ™§ğ™™ğ™¨ <ğ™¤ğ™£/ğ™¤ğ™›ğ™›>

ğŸ’° ğ™€ğ˜¾ğ™Šğ™‰ğ™Šğ™ˆğ™” ğ™ˆğ™€ğ™‰ğ™ ğŸ’°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™–ğ™˜ğ™˜ğ™—ğ™–ğ™¡ [@ğ™ªğ™¨ğ™šğ™§]
á¯½ .ğ™™ğ™šğ™¥ğ™¤ğ™¨ğ™ğ™© <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™¬ğ™ğ™©ğ™ğ™™ğ™§ğ™–ğ™¬ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™¨ğ™šğ™£ğ™™ @ğ™ªğ™¨ğ™šğ™§ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™™ğ™–ğ™ğ™¡ğ™®
á¯½ .ğ™¬ğ™šğ™šğ™ ğ™¡ğ™®
á¯½ .ğ™¢ğ™¤ğ™£ğ™©ğ™ğ™¡ğ™®
á¯½ .ğ™ğ™£ğ™«
á¯½ .ğ™¬ğ™¤ğ™§ğ™ 
á¯½ .ğ™§ğ™¤ğ™— @ğ™ªğ™¨ğ™šğ™§

ğŸ° ğ™‚ğ˜¼ğ™ˆğ˜½ğ™‡ğ™„ğ™‰ğ™‚ ğ™ˆğ™€ğ™‰ğ™ ğŸ°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™œğ™–ğ™¢ğ™—ğ™¡ğ™š <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™¨ğ™¡ğ™¤ğ™©ğ™¨ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™§ğ™¤ğ™ªğ™¡ğ™šğ™©ğ™©ğ™š <ğ™—ğ™šğ™©> <ğ™˜ğ™¤ğ™¡ğ™¤ğ™§/ğ™£ğ™ªğ™¢ğ™—ğ™šğ™§>
á¯½ .ğ™—ğ™¡ğ™–ğ™˜ğ™ ğ™Ÿğ™–ğ™˜ğ™  <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™˜ğ™¤ğ™ğ™£ğ™›ğ™¡ğ™ğ™¥ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©> <ğ™ğ™šğ™–ğ™™ğ™¨/ğ™©ğ™–ğ™ğ™¡ğ™¨>
á¯½ .ğ™™ğ™ğ™˜ğ™š <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™¡ğ™¤ğ™©ğ™©ğ™šğ™§ğ™®
á¯½ .ğ™Ÿğ™–ğ™˜ğ™ ğ™¥ğ™¤ğ™©
á¯½ .ğ™˜ğ™§ğ™–ğ™¨ğ™ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™§ğ™–ğ™˜ğ™š <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™¬ğ™ğ™šğ™šğ™¡ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™¥ğ™¤ğ™ ğ™šğ™§ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™¢ğ™ğ™£ğ™šğ™¨ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™¥ğ™¡ğ™ğ™£ğ™ ğ™¤ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©>
á¯½ .ğ™¡ğ™ğ™¢ğ™—ğ™¤ <ğ™–ğ™¢ğ™¤ğ™ªğ™£ğ™©> <ğ™¢ğ™ªğ™¡ğ™©ğ™ğ™¥ğ™¡ğ™ğ™šğ™§>

ğŸ” ğ™ğ™€ğ˜¼ğ™ğ˜¾ğ™ƒ ğ™ˆğ™€ğ™‰ğ™ ğŸ”
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™œğ™¥ğ™© <ğ™¦ğ™ªğ™šğ™§ğ™®>
á¯½ .ğ™–ğ™ <ğ™¦ğ™ªğ™šğ™§ğ™®>
á¯½ .ğ™œğ™¤ğ™¤ğ™œğ™¡ğ™š <ğ™¦ğ™ªğ™šğ™§ğ™®>

ğŸ–¼ï¸ ğ™„ğ™ˆğ˜¼ğ™‚ğ™€ ğ™ˆğ™€ğ™‰ğ™ ğŸ–¼ï¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™¨ğ™©ğ™ğ™˜ğ™ ğ™šğ™§
á¯½ .ğ™—ğ™¡ğ™ªğ™§
á¯½ .ğ™§ğ™šğ™¢ğ™¤ğ™«ğ™šğ™—ğ™œ

ğŸŒŸ ğ™ğ™ğ™‰ ğ™ˆğ™€ğ™‰ğ™ ğŸŒŸ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™¢ğ™–ğ™©ğ™˜ğ™ [@ğ™ªğ™¨ğ™šğ™§]
á¯½ .ğ™§ğ™¤ğ™–ğ™¨ğ™© @ğ™ªğ™¨ğ™šğ™§
á¯½ .ğ™¨ğ™ğ™¢ğ™¥ @ğ™ªğ™¨ğ™šğ™§

ğŸª· ğ˜¿ğ™Šğ™’ğ™‰ğ™‡ğ™Šğ˜¼ğ˜¿ ğ™ˆğ™€ğ™‰ğ™ ğŸª·
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
á¯½ .ğ™¥ğ™¡ğ™–ğ™® <ğ™¨ğ™¤ğ™£ğ™œ>
á¯½ .ğ™ğ™£ğ™¨ğ™©ğ™–ğ™œğ™§ğ™–ğ™¢ <ğ™ªğ™§ğ™¡>
á¯½ .ğ™©ğ™ğ™ ğ™©ğ™¤ğ™  <ğ™ªğ™§ğ™¡>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’œ ğ—©ğ—¶ğ—¼ğ—¹ğ—²ğ˜ ğ—•ğ˜† ğ—ğ˜†ğ—»ğ˜…`;

    await sock.sendMessage(from, { text: menuText }, { quoted: msg });
};

const ping = async ({ sock, msg, from }) => {
    const start = Date.now();
    const sent = await sock.sendMessage(from, { 
        text: 'â•­â”â”ğ–£” ğ—£ğ—œğ—¡ğ—š ğ–£”â”â”â•®\nâ”‚  â³ Calculating...\nâ•°â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯' 
    }, { quoted: msg });
    
    const end = Date.now();
    const ping = end - start;
    
    await sock.sendMessage(from, { 
        text: `â•­â”â”ğ–£” ğ—£ğ—¢ğ—¡ğ—š ğ–£”â”â”â•®\nâ”‚\nâ”‚  âš¡ Speed: ${ping}ms\nâ”‚  ğŸ¤– Status: Online\nâ”‚  ğŸ”¥ Server: Active\nâ”‚\nâ•°â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯`,
        edit: sent.key
    });
};

const alive = async ({ sock, msg, from }) => {
    const uptime = process.uptime();
    const hours = Math.floor(uptime / 3600);
    const minutes = Math.floor((uptime % 3600) / 60);
    
    const aliveText = `â•­â”â”ğ–£” ğ—•ğ—¢ğ—§ ğ—¦ğ—§ğ—”ğ—§ğ—¨ğ—¦ ğ–£”â”â”â•®
â”‚
â”‚  âœ… Bot is Alive!
â”‚  ğŸ‘‘ Owner: Kynx
â”‚  â° Uptime: ${hours}h ${minutes}m
â”‚  ğŸ”¥ Database: Firebase
â”‚  âš¡ Status: Active
â”‚
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯`;

    await sock.sendMessage(from, { text: aliveText }, { quoted: msg });
};

const afk = async ({ sock, msg, from, sender, args, db }) => {
    const reason = args.join(' ') || 'No reason';
    const userRef = db.collection('users').doc(sender);
    
    await userRef.update({
        afk: true,
        afkReason: reason,
        afkTime: Date.now()
    });

    await sock.sendMessage(from, {
        text: `â•­â”â”ğ–£” ğ—”ğ—™ğ— ğ— ğ—¢ğ——ğ—˜ ğ–£”â”â”â•®
â”‚
â”‚  ğŸ˜´ You are now AFK
â”‚  ğŸ“ Reason: ${reason}
â”‚
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯`
    }, { quoted: msg });
};

const register = async ({ sock, msg, from, sender, db }) => {
    const userRef = db.collection('users').doc(sender);
    const userDoc = await userRef.get();

    if (userDoc.exists) {
        return await sock.sendMessage(from, {
            text: 'â•­â”â”ğ–£” ğ—”ğ—Ÿğ—¥ğ—˜ğ—”ğ——ğ—¬ ğ—¥ğ—˜ğ—šğ—œğ—¦ğ—§ğ—˜ğ—¥ğ—˜ğ—— ğ–£”â”â”â•®\nâ”‚\nâ”‚  âœ… You are already registered!\nâ”‚\nâ•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯'
        }, { quoted: msg });
    }

    await userRef.set({
        id: sender,
        name: 'User',
        age: 0,
        bio: 'No bio set',
        registeredAt: Date.now(),
        wallet: 1000,
        bank: 0,
        cards: [],
        level: 1,
        xp: 0,
        afk: false,
        lastDaily: 0,
        lastWeekly: 0,
        lastMonthly: 0,
        lastWork: 0
    });

    await sock.sendMessage(from, {
        text: `â•­â”â”ğ–£” ğ—¥ğ—˜ğ—šğ—œğ—¦ğ—§ğ—¥ğ—”ğ—§ğ—œğ—¢ğ—¡ ğ–£”â”â”â•®
â”‚
â”‚  âœ… Registration Successful!
â”‚  ğŸ’° Starting Wallet: 1000 coins
â”‚  ğŸ´ Starting Cards: 0
â”‚  ğŸ“Š Level: 1
â”‚
â”‚  Use .menu to get started!
â”‚
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯`
    }, { quoted: msg });
};

const leaderboard = async ({ sock, msg, from, db }) => {
    const usersSnapshot = await db.collection('users').orderBy('wallet', 'desc').limit(10).get();
    
    let lbText = `â•­â”â”ğ–£” ğ—Ÿğ—˜ğ—”ğ——ğ—˜ğ—¥ğ—•ğ—¢ğ—”ğ—¥ğ—— ğ–£”â”â”â•®
â”‚
â”‚  ğŸ’° ğ—§ğ—¼ğ—½ ğ—¥ğ—¶ğ—°ğ—µğ—²ğ˜€ğ˜ ğ—¨ğ˜€ğ—²ğ—¿ğ˜€
â”‚\n`;

    let rank = 1;
    usersSnapshot.forEach(doc => {
        const data = doc.data();
        const name = data.name || 'Unknown';
        const wallet = data.wallet || 0;
        lbText += `â”‚  ${rank}. ${name}: ${wallet} coins\n`;
        rank++;
    });

    lbText += `â”‚\nâ•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯`;

    await sock.sendMessage(from, { text: lbText }, { quoted: msg });
};

const market = async ({ sock, msg, from }) => {
    const marketText = `â•­â”â”ğ–£” ğ— ğ—”ğ—¥ğ—ğ—˜ğ—§ ğ–£”â”â”â•®
â”‚
â”‚  ğŸª ğ—–ğ—®ğ—¿ğ—± ğ— ğ—®ğ—¿ğ—¸ğ—²ğ˜
â”‚
â”‚  ğŸ´ Common Card - 500 coins
â”‚  ğŸŒŸ Rare Card - 2000 coins
â”‚  ğŸ’ Epic Card - 5000 coins
â”‚  ğŸ‘‘ Legendary - 10000 coins
â”‚
â”‚  Use .buy <type> to purchase
â”‚
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯`;

    await sock.sendMessage(from, { text: marketText }, { quoted: msg });
};

const mugen = async ({ sock, msg, from }) => {
    await sock.sendMessage(from, {
        text: 'â•­â”â”ğ–£” ğ— ğ—¨ğ—šğ—˜ğ—¡ ğ–£”â”â”â•®\nâ”‚\nâ”‚  ğŸŒ€ Mugen Feature\nâ”‚  â³ Coming Soon...\nâ”‚\nâ•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯'
    }, { quoted: msg });
};

module.exports = {
    menu,
    ping,
    alive,
    afk,
    register,
    reg: register,
    leaderboard,
    lb: leaderboard,
    market,
    mugen
};
